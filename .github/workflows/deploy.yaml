name: Deploy Helm charts
on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  deploy-charts:
    name: Deploy Helm charts
    runs-on: ubuntu-latest
    steps:
      - name: Checkout configuration
        uses: actions/checkout@v4
      - name: Deploy public-fullstack-app chart
        run: |
          cd public-fullstack-app
          helm package .
          curl --user ${{ secrets.ORG_CHARTMUSEUM_USER }}:${{ secrets.ORG_CHARTMUSEUM_PASS }} --data-binary "@$(ls -1 | grep .tgz | head -1)" https://chartmuseum.masterofcubesau.com/api/charts
